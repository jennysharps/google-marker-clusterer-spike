---
title: Home
---

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
  </head>
  <body>
    <template id="offCanvasContent">
      <div class="offcanvas-header">
        <h5 class="offcanvas-title" id="offcanvasLabel"></h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          data-bs-dismiss="offcanvas"
          aria-label="Close"
        ></button>
      </div>
      <div class="offcanvas-body"></div>
    </template>

    <main class="map-wrapper">
      <div
        class="offcanvas offcanvas-start"
        id="offcanvas"
        data-bs-backdrop="false"
        tabindex="-1"
        aria-labelledby="offcanvasLabel"
      ></div>
      <div id="map"></div>
    </main>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3"
      crossorigin="anonymous"
    />
    <style>
      html,
      body {
        height: 100%;
        margin: 0;
      }
      .map-wrapper {
        position: relative;
        overflow: hidden;
        width: 100%;
        height: 100%;
        /* box-shadow: 5px 10px #888888; */
      }
      #map {
        width: 100%;
        height: 100%;
        z-index: 1;
      }
      #offcanvas {
        position: absolute;
        background-color: #fafafa;
        box-shadow: 0 0 6px rgb(0 0 0 / 30%);
        max-width: 60%;
      }
      .offcanvas-header {
        color: #fff;
        background-color: #ed1c24;
        padding: 10px 24px;
      }
      .btn-close {
        opacity: 0.9;
      }
      .offcanvas-title {
        margin: 6px 0;
      }
      .offcanvas-body {
        font-size: 14px;
        padding: 10px 24px 20px;
      }
      .offcanvas-body p {
        margin: 16px 0 26px;
      }
    </style>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
      crossorigin="anonymous"
    ></script>
    <script src="https://unpkg.com/@googlemaps/markerclusterer/dist/index.min.js"></script>
    <script>
      const contentTemplate = document.querySelector("#offCanvasContent");
      const offCanvasEl = document.getElementById("offcanvas");
      let visibleMarker = null;
      let bounds;
      let animationTimeout;

      const clusterSVG = window.btoa(`
        <svg fill="#ED1C24" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 240 240">
          <circle cx="120" cy="120" opacity=".8" r="70" />
          <circle cx="120" cy="120" opacity=".4" r="90" />
          <circle cx="120" cy="120" opacity=".2" r="110" />
        </svg>`);

      const markerSVG = (projectType, selected) => {
        const { fillColor, fillOpacity, strokeOpacity } =
          projectTypeIconProps[projectType];

        return window.btoa(`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 34 34">
        <defs>
          <style type="text/css"><![CDATA[
            .shadow {
              -webkit-filter: drop-shadow(1px 1px 0.75px rgb(0 0 0 / 0.15));
              filter: drop-shadow(1px 1px 0.75px rgb(0 0 0 / 0.15));
            }
          ]]></style>
        </defs>
        ${
          selected
            ? `<circle class="shadow" fill="white" cx="16" cy="17" opacity=".7" r="15" />`
            : ""
        }
        <svg x="4" y="5">
          <path class="shadow" d="M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z" fill="${fillColor}" fill-opacity="1" stroke="white" stroke-width="0.5" />
        </svg>
        <circle fill="white" cx="16" cy="14" opacity="1" r="2.5" />
      </svg>`);
      };

      const projectTypeIconProps = {
        NEW: {},
        PAST: {
          fillColor: "#006A6E",
        },
        ONGOING: {
          fillColor: "#ed1c24",
        },
      };

      const iconProps = (projectType) => {
        return {
          url: `data:image/svg+xml;base64,${markerSVG(projectType, false)}`,
          scaledSize: new google.maps.Size(52, 52),
        };
      };

      const selectedIconProps = (projectType) => {
        return {
          url: `data:image/svg+xml;base64,${markerSVG(projectType, true)}`,
          scaledSize: new google.maps.Size(52, 52),
        };
      };

      const cancelAnimation = () => {
        if (animationTimeout) {
          clearTimeout(animationTimeout);
          visibleMarker.setAnimation(google.maps.Animation.NULL);
        }
      };

      const unselectMarker = (marker) => {
        if (!marker) {
          return;
        }

        cancelAnimation();

        marker.setIcon(iconProps(marker.projectType));
        marker.setZIndex(undefined);
      };

      offCanvasEl.addEventListener("hide.bs.offcanvas", function () {
        unselectMarker(visibleMarker);
      });

      const showDetailsOverlay = (marker) => {
        cancelAnimation();
        const { projectName, locationName, description, projectType } = marker;
        unselectMarker(visibleMarker);
        visibleMarker = marker;

        const offCanvasContent = contentTemplate.content.cloneNode(true);
        offCanvasContent.querySelector(".offcanvas-title").innerText =
          projectName || locationName;
        offCanvasContent.querySelector(
          ".offcanvas-body"
        ).innerHTML = `<p>${description}</p>`;
        offCanvasEl.innerHTML = "";
        offCanvasEl.appendChild(offCanvasContent);

        // Initialize the off canvas overlay
        const bsOffcanvas = new bootstrap.Offcanvas(offcanvas);
        bsOffcanvas.show();

        visibleMarker.setAnimation(google.maps.Animation.BOUNCE);
        animationTimeout = setTimeout(() => {
          cancelAnimation();
        }, 750);

        marker.setZIndex(Number(google.maps.Marker.MAX_ZINDEX) + 1000);
        marker.setIcon(selectedIconProps(projectType));
      };

      document.addEventListener("click", (evt) => {
        const instance = bootstrap.Offcanvas.getInstance(offCanvasEl);

        if (!instance) {
          return;
        }
        let targetElement = evt.target; // clicked element

        do {
          if (targetElement === offCanvasEl) {
            // This is a click inside. Do nothing, just return.
            return;
          }

          // Click on google map image (marker, marker cluster icon, etc)
          const src =
            targetElement.getAttribute && targetElement.getAttribute("src");
          if (src === "https://maps.gstatic.com/mapfiles/transparent.png") {
            const title = targetElement.parentNode.getAttribute("title");

            // Click on marker. Do nothing, just return.
            if (title) {
              return;
            }
            // Click on something other than a marker; continue traversing;
          }
          // Go up the DOM
          targetElement = targetElement.parentNode;
        } while (targetElement);

        // This is a click outside.
        bootstrap.Offcanvas.getInstance(offCanvasEl).hide();
      });

      const locations = {{ site.data.locations | jsonify }};

      const getMarkers = (map) => {
        const markers = [];
        const bounds = new google.maps.LatLngBounds();

        locations.forEach(
          ({
            location,
            projectName,
            locationName,
            description,
            projectType,
          }) => {
            if (projectType === "NEW") {
              return;
            }

            const marker = new google.maps.Marker({
              position: location,
              icon: iconProps(projectType),
              title: locationName || projectName,
              animation: google.maps.Animation.DROP,
              optimized: false,
              projectName,
              locationName,
              description,
              projectType,
            });

            bounds.extend(location);

            google.maps.event.addListener(marker, "click", () => {
              const offCanvasWidth = offCanvasEl
                ? offCanvasEl.offsetWidth
                : null;

              // Center and then offset by half of overlay width
              map.panTo(marker.getPosition());
              map.panBy(-offCanvasWidth / 2, 0);
              showDetailsOverlay(marker);
            });

            markers.push(marker);
          }
        );

        return { markers, bounds };
      };

      function initMap() {
        const map = new google.maps.Map(document.getElementById("map"), {
          zoom: 2.5,
          center: { lat: 10, lng: 10 },
          mapTypeControl: false,
          streetViewControl: false,
          gestureHandling: "greedy",
        });

        const { markers, bounds } = getMarkers(map);

        new markerClusterer.MarkerClusterer({
          map,
          markers,
          renderer: {
            render: function ({ count, position }, stats) {
              return new google.maps.Marker({
                position,
                icon: {
                  url: `data:image/svg+xml;base64,${clusterSVG}`,
                  scaledSize: new google.maps.Size(45, 45),
                },
                label: {
                  text: String(count),
                  color: "white",
                  fontSize: "12px",
                },
                // adjust zIndex to be above other markers
                zIndex: Number(google.maps.Marker.MAX_ZINDEX) + count,
              });
            },
          },
        });

        map.fitBounds(bounds);
      }
    </script>

    <script
      src="https://maps.googleapis.com/maps/api/js?key=AIzaSyC_-NGDykCYRs7Hyz8pOkSkO4bDsDSAKtk&callback=initMap&v=weekly"
      defer
    ></script>
  </body>
</html>
